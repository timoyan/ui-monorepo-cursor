import{r as e,c as t,h as i,g as r}from"./p-B89yKvQN.js";const n=()=>`.credit-card-form.sc-credit-card-form{display:block;width:100%}.adyen-container.sc-credit-card-form{width:100%;min-height:200px}.adyen-container.disabled.sc-credit-card-form{opacity:0.6;pointer-events:none}.error-message.sc-credit-card-form{margin-top:12px;padding:12px;background-color:#fee;border:1px solid #fcc;border-radius:4px;color:#c33;font-size:14px}.credit-card-form.sc-credit-card-form .sc-credit-card-form:global(.adyen-checkout__input){font-family:inherit}.credit-card-form.sc-credit-card-form .sc-credit-card-form:global(.adyen-checkout__input--error){border-color:#c33}`;const o=class{constructor(i){e(this,i);this.formReady=t(this,"formReady");this.formChange=t(this,"formChange");this.formSubmit=t(this,"formSubmit");this.formError=t(this,"formError");this.disabled=false;this.isReady=false;this.isValid=false;this.errorMessage="";this.adyenCheckout=null;this.cardComponent=null;this.containerId=`adyen-card-container-${Math.random().toString(36).substr(2,9)}`;this.isInitializing=false}async componentDidLoad(){await this.initializeAdyen()}async disconnectedCallback(){if(this.cardComponent?.unmount){this.cardComponent.unmount()}}checkAdyenLoaded(){if(typeof window==="undefined"){return false}const e=window;if(!e.AdyenCheckout){return false}const t=e.AdyenCheckout;if(typeof t!=="function"){return false}if(!e.Card){return false}const i=e.Card;return typeof i==="function"}waitForAdyenSDK(){return new Promise(((e,t)=>{if(this.checkAdyenLoaded()){e();return}let i=0;const r=100;let n=null;let o=false;const s=()=>{setTimeout((()=>{if(this.checkAdyenLoaded()){if(n!==null){clearInterval(n)}if(o){window.removeEventListener("adyen-sdk-loaded",s);window.removeEventListener("adyen-sdk-error",a)}console.log("Adyen SDK loaded and ready");e()}}),100)};const a=e=>{if(n!==null){clearInterval(n)}if(o){window.removeEventListener("adyen-sdk-loaded",s);window.removeEventListener("adyen-sdk-error",a)}const i=e.detail;t(new Error(`Adyen SDK failed to load: ${i||"Unknown error"}`))};window.addEventListener("adyen-sdk-loaded",s);window.addEventListener("adyen-sdk-error",a);o=true;n=setInterval((()=>{i++;if(this.checkAdyenLoaded()){if(n!==null){clearInterval(n)}if(o){window.removeEventListener("adyen-sdk-loaded",s);window.removeEventListener("adyen-sdk-error",a)}console.log("Adyen SDK detected via polling");e()}else if(i>=r){if(n!==null){clearInterval(n)}if(o){window.removeEventListener("adyen-sdk-loaded",s);window.removeEventListener("adyen-sdk-error",a)}const e=window;console.error("Adyen SDK timeout. Debug info:",{AdyenCheckout:!!e.AdyenCheckout,AdyenCheckoutType:typeof e.AdyenCheckout,windowKeys:Object.keys(window).filter((e=>e.toLowerCase().includes("adyen"))),scriptTags:Array.from(document.scripts).map((e=>e.src))});t(new Error("Adyen SDK failed to load: timeout after 10 seconds. Please ensure the Adyen SDK is loaded via CDN."))}}),100)}))}async initializeAdyen(){if(this.isInitializing){return}try{if(typeof window==="undefined"){return}this.isInitializing=true;await this.waitForAdyenSDK();await this.createAdyenCheckout()}catch(e){this.handleError("Failed to initialize Adyen",e)}finally{this.isInitializing=false}}async createAdyenCheckout(){try{const e=window;const t=e.AdyenCheckout;if(!t||typeof t!=="function"){throw new Error("AdyenCheckout is not available or not a function")}const i={environment:this.adyenConfig.environment,clientKey:this.adyenConfig.clientKey,locale:this.adyenConfig.locale||"en-US",countryCode:this.adyenConfig.countryCode,onSubmit:async(e,t,i)=>{try{if(this.adyenConfig.onSubmit){await this.adyenConfig.onSubmit(e,t,i)}const r=this.extractFormData(e);if(r){this.formSubmit.emit(r)}if(i){i.resolve()}}catch(e){if(i){i.reject()}this.handleError("Payment submission error",e)}},onError:(e,t)=>{if(this.adyenConfig.onError){this.adyenConfig.onError(e,t)}this.handleError("Payment error",e)},onChange:(e,t)=>{if(this.adyenConfig.onChange){this.adyenConfig.onChange(e,t)}this.handleChange(e)}};const r=await t(i);if(!r||typeof r!=="object"){throw new Error("Failed to create Adyen Checkout instance")}this.adyenCheckout=r;await this.createCardComponent()}catch(e){this.handleError("Failed to create Adyen checkout",e)}}async createCardComponent(){if(!this.adyenCheckout){throw new Error("Adyen Checkout instance is not available")}const e=this.el.querySelector(`#${this.containerId}`);if(!e){throw new Error(`Container element #${this.containerId} not found`)}const t=window;if(!t.Card||typeof t.Card!=="function"){throw new Error("Card constructor is not available. Please ensure Adyen SDK v6 is loaded.")}try{const e={showPayButton:this.adyenConfig.showPayButton??false,placeholder:this.placeholder||{},onChange:e=>{const t=e;this.isValid=t.isValid;if(t.isValid){this.errorMessage=""}this.handleChange(e)}};const i=t.Card;this.cardComponent=new i(this.adyenCheckout,e);if(!this.cardComponent){throw new Error("Failed to create Card component: component is null")}if(!this.cardComponent.mount||typeof this.cardComponent.mount!=="function"){throw new Error("Failed to create Card component: mount method is not available")}await new Promise((e=>setTimeout(e,0)));this.cardComponent.mount(`#${this.containerId}`);this.isReady=true;this.formReady.emit()}catch(e){this.handleError("Failed to create Card component",e);throw e}}extractFormData(e){const t=e;if(t.isValid&&t.data?.paymentMethod){const e=t.data.paymentMethod;return{cardNumber:e.encryptedCardNumber||"",expiryDate:e.encryptedExpiryDate||"",cvc:e.encryptedSecurityCode||"",holderName:e.holderName||""}}return null}handleChange(e){const t=e;if(t.isValid&&t.data?.paymentMethod){const e=t.data.paymentMethod;const i={cardNumber:e.encryptedCardNumber||"",expiryDate:e.encryptedExpiryDate||"",cvc:e.encryptedSecurityCode||"",holderName:e.holderName||""};this.formChange.emit(i)}}handleError(e,t){this.errorMessage=e;this.formError.emit({message:e,error:t});console.error(`[CreditCardForm] ${e}:`,t)}render(){return i("div",{key:"b8612301c6ce957882e49fe879f167f34d1f39fb",class:"credit-card-form"},i("div",{key:"375ca48e180a60918bcd855b76d00d126aacac3a",id:this.containerId,class:`adyen-container ${this.disabled?"disabled":""}`}),this.errorMessage&&i("div",{key:"d01deec43e032f5f3641318df86f8b3a621ed910",class:"error-message",role:"alert"},this.errorMessage))}get el(){return r(this)}};o.style=n();export{o as CreditCardForm};