import{r as e,c as t,h as i,g as o}from"./p-B89yKvQN.js";const r=()=>`.credit-card-form.sc-credit-card-form{display:block;width:100%}.adyen-container.sc-credit-card-form{width:100%;min-height:200px}.adyen-container.disabled.sc-credit-card-form{opacity:0.6;pointer-events:none}.error-message.sc-credit-card-form{margin-top:12px;padding:12px;background-color:#fee;border:1px solid #fcc;border-radius:4px;color:#c33;font-size:14px}.credit-card-form.sc-credit-card-form .sc-credit-card-form:global(.adyen-checkout__input){font-family:inherit}.credit-card-form.sc-credit-card-form .sc-credit-card-form:global(.adyen-checkout__input--error){border-color:#c33}`;const d=class{constructor(i){e(this,i);this.formReady=t(this,"formReady");this.formChange=t(this,"formChange");this.formSubmit=t(this,"formSubmit");this.formError=t(this,"formError");this.disabled=false;this.isReady=false;this.isValid=false;this.errorMessage="";this.adyenCheckout=null;this.cardComponent=null;this.containerId=`adyen-card-container-${Math.random().toString(36).substr(2,9)}`}async componentDidLoad(){await this.initializeAdyen()}async disconnectedCallback(){if(this.cardComponent?.unmount){this.cardComponent.unmount()}}async initializeAdyen(){try{if(typeof window==="undefined"){return}const e=()=>{const e=window;return!!(e.AdyenCheckout||e.Adyen||e.AdyenCheckout?.create)};if(!e()){let t=0;const i=75;const o=()=>new Promise(((o,r)=>{let d=null;const n=()=>{setTimeout((()=>{if(e()){window.removeEventListener("adyen-sdk-loaded",n);window.removeEventListener("adyen-sdk-error",s);if(d!==null){clearInterval(d)}console.log("Adyen SDK confirmed loaded");o()}else{console.warn("Adyen SDK loaded event received but SDK not available yet")}}),50)};const s=e=>{window.removeEventListener("adyen-sdk-loaded",n);window.removeEventListener("adyen-sdk-error",s);if(d!==null){clearInterval(d)}const t=e.detail;const i=t&&typeof t==="object"?"Adyen SDK failed to load from CDN":"Adyen SDK failed to load from CDN";r(new Error(i))};window.addEventListener("adyen-sdk-loaded",n);window.addEventListener("adyen-sdk-error",s);d=setInterval((()=>{t++;if(e()){window.removeEventListener("adyen-sdk-loaded",n);window.removeEventListener("adyen-sdk-error",s);if(d!==null){clearInterval(d)}console.log("Adyen SDK detected via polling");o()}else if(t>=i){window.removeEventListener("adyen-sdk-loaded",n);window.removeEventListener("adyen-sdk-error",s);if(d!==null){clearInterval(d)}const e=window;console.error("Adyen SDK timeout. Debug info:",{AdyenCheckout:!!e.AdyenCheckout,Adyen:!!e.Adyen,windowKeys:Object.keys(window).filter((e=>e.toLowerCase().includes("adyen"))),scriptTags:Array.from(document.scripts).map((e=>e.src))});r(new Error("Adyen SDK failed to load: timeout after 15 seconds"))}}),200)}));try{await o();await this.createAdyenCheckout()}catch(e){this.handleError("Adyen SDK 尚未載入，請確保已通過 CDN 引入 Adyen Web SDK",e)}}else{await this.createAdyenCheckout()}}catch(e){this.handleError("Failed to initialize Adyen",e)}}async createAdyenCheckout(){try{const e=window.AdyenCheckout;if(!e){throw new Error("AdyenCheckout is not available")}const t={environment:this.adyenConfig.environment,clientKey:this.adyenConfig.clientKey,locale:this.adyenConfig.locale||"en-US",onSubmit:(e,t)=>{if(this.adyenConfig.onSubmit){this.adyenConfig.onSubmit(e,t)}this.handleSubmit(e)},onError:(e,t)=>{if(this.adyenConfig.onError){this.adyenConfig.onError(e,t)}this.handleError("Payment error",e)},onChange:(e,t)=>{if(this.adyenConfig.onChange){this.adyenConfig.onChange(e,t)}this.handleChange(e)}};if(this.adyenConfig.countryCode){t.countryCode=this.adyenConfig.countryCode}this.adyenCheckout=await e(t);const i=this.el.querySelector(`#${this.containerId}`);if(i&&this.adyenCheckout){const e=this.adyenCheckout;this.cardComponent=e.create("card",{showPayButton:this.adyenConfig.showPayButton??false,placeholder:this.placeholder||{},onChange:e=>{const t=e;this.isValid=t.isValid;if(t.isValid){this.errorMessage=""}}});if(this.cardComponent?.mount){this.cardComponent.mount(`#${this.containerId}`)}this.isReady=true;this.formReady.emit()}}catch(e){this.handleError("Failed to create Adyen checkout",e)}}handleSubmit(e){const t=e;if(t.isValid){const e=t.data?.paymentMethod;const i={cardNumber:e?.encryptedCardNumber||"",expiryDate:e?.encryptedExpiryDate||"",cvc:e?.encryptedSecurityCode||"",holderName:e?.holderName||""};this.formSubmit.emit(i)}}handleChange(e){const t=e;if(t.isValid){const e=t.data?.paymentMethod;const i={cardNumber:e?.encryptedCardNumber||"",expiryDate:e?.encryptedExpiryDate||"",cvc:e?.encryptedSecurityCode||"",holderName:e?.holderName||""};this.formChange.emit(i)}}handleError(e,t){this.errorMessage=e;this.formError.emit({message:e,error:t})}render(){return i("div",{key:"c421234a02e5d7019aef216a1bd6d09512ff2542",class:"credit-card-form"},i("div",{key:"b4a056ebf76e0cc1e7d7b0f432937d03309c7a73",id:this.containerId,class:`adyen-container ${this.disabled?"disabled":""}`}),this.errorMessage&&i("div",{key:"d6d9303edc982d1b4ddacbf5598d79ea8e3fa36b",class:"error-message",role:"alert"},this.errorMessage))}get el(){return o(this)}};d.style=r();export{d as CreditCardForm};