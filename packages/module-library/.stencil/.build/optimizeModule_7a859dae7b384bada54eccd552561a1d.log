import{proxyCustomElement as t,HTMLElement as e,createEvent as r,h as i,transformTag as n}from"@stencil/core/internal/client";export{getAssetPath,render,setAssetPath,setNonce,setPlatformOptions}from"@stencil/core/internal/client";const o=()=>`.credit-card-form.sc-credit-card-form{display:block;width:100%}.adyen-container.sc-credit-card-form{width:100%;min-height:200px}.adyen-container.disabled.sc-credit-card-form{opacity:0.6;pointer-events:none}.error-message.sc-credit-card-form{margin-top:12px;padding:12px;background-color:#fee;border:1px solid #fcc;border-radius:4px;color:#c33;font-size:14px}.credit-card-form.sc-credit-card-form .sc-credit-card-form:global(.adyen-checkout__input){font-family:inherit}.credit-card-form.sc-credit-card-form .sc-credit-card-form:global(.adyen-checkout__input--error){border-color:#c33}`;let a=null;let s=null;async function c(){if(typeof window==="undefined"){return false}try{const t=await import("@adyen/adyen-web");a=t.AdyenCheckout;s=t.Card;return true}catch(t){console.error("Failed to load Adyen SDK:",t);return false}}const d=t(class t extends e{constructor(t){super();if(t!==false){this.__registerHost()}this.formReady=r(this,"formReady",7);this.formChange=r(this,"formChange",7);this.formSubmit=r(this,"formSubmit",7);this.formError=r(this,"formError",7);this.disabled=false;this.isReady=false;this.isValid=false;this.errorMessage="";this.adyenCheckout=null;this.cardComponent=null;this.containerId=`adyen-card-container-${Math.random().toString(36).substr(2,9)}`;this.isInitializing=false}async componentDidLoad(){await this.initializeAdyen()}async disconnectedCallback(){if(this.cardComponent?.unmount){this.cardComponent.unmount()}}checkAdyenLoaded(){return a!==null&&typeof a==="function"&&s!==null&&typeof s==="function"}async loadAdyenSDK(){if(this.checkAdyenLoaded()){return}const t=await c();if(!t){throw new Error("Failed to load Adyen SDK. Please ensure @adyen/adyen-web is installed.")}if(!this.checkAdyenLoaded()){throw new Error("Adyen SDK loaded but AdyenCheckout or Card is not available.")}}async initializeAdyen(){if(this.isInitializing){return}try{if(typeof window==="undefined"){return}this.isInitializing=true;await this.loadAdyenSDK();await this.createAdyenCheckout()}catch(t){this.handleError("Failed to initialize Adyen",t)}finally{this.isInitializing=false}}async createAdyenCheckout(){try{if(!a||typeof a!=="function"){throw new Error("AdyenCheckout is not available or not a function")}const t={environment:this.adyenConfig.environment,clientKey:this.adyenConfig.clientKey,locale:this.adyenConfig.locale||"en-US",countryCode:this.adyenConfig.countryCode,onSubmit:async(t,e,r)=>{try{if(this.adyenConfig.onSubmit){await this.adyenConfig.onSubmit(t,e,r)}const i=this.extractFormData(t);if(i){this.formSubmit.emit(i)}if(r){r.resolve()}}catch(t){if(r){r.reject()}this.handleError("Payment submission error",t)}},onError:(t,e)=>{if(this.adyenConfig.onError){this.adyenConfig.onError(t,e)}this.handleError("Payment error",t)},onChange:(t,e)=>{if(this.adyenConfig.onChange){this.adyenConfig.onChange(t,e)}this.handleChange(t)}};const e=await a(t);if(!e||typeof e!=="object"){throw new Error("Failed to create Adyen Checkout instance")}this.adyenCheckout=e;await this.createCardComponent()}catch(t){this.handleError("Failed to create Adyen checkout",t)}}async createCardComponent(){if(!this.adyenCheckout){throw new Error("Adyen Checkout instance is not available")}const t=this.el.querySelector(`#${this.containerId}`);if(!t){throw new Error(`Container element #${this.containerId} not found`)}if(!s||typeof s!=="function"){throw new Error("Card constructor is not available. Please ensure @adyen/adyen-web is installed.")}try{const t={showPayButton:this.adyenConfig.showPayButton??false,placeholder:this.placeholder||{},onChange:t=>{const e=t;this.isValid=e.isValid;if(e.isValid){this.errorMessage=""}this.handleChange(t)}};this.cardComponent=new s(this.adyenCheckout,t);if(!this.cardComponent){throw new Error("Failed to create Card component: component is null")}if(!this.cardComponent.mount||typeof this.cardComponent.mount!=="function"){throw new Error("Failed to create Card component: mount method is not available")}await new Promise((t=>setTimeout(t,0)));this.cardComponent.mount(`#${this.containerId}`);this.isReady=true;this.formReady.emit()}catch(t){this.handleError("Failed to create Card component",t);throw t}}extractFormData(t){const e=t;if(e.isValid&&e.data?.paymentMethod){const t=e.data.paymentMethod;return{cardNumber:t.encryptedCardNumber||"",expiryDate:t.encryptedExpiryDate||"",cvc:t.encryptedSecurityCode||"",holderName:t.holderName||""}}return null}handleChange(t){const e=t;if(e.isValid&&e.data?.paymentMethod){const t=e.data.paymentMethod;const r={cardNumber:t.encryptedCardNumber||"",expiryDate:t.encryptedExpiryDate||"",cvc:t.encryptedSecurityCode||"",holderName:t.holderName||""};this.formChange.emit(r)}}handleError(t,e){this.errorMessage=t;this.formError.emit({message:t,error:e});console.error(`[CreditCardForm] ${t}:`,e)}render(){return i("div",{key:"cea577c307bc242e06eb52508098626f2d746af3",class:"credit-card-form"},i("div",{key:"c3a6a6248874d9b42446b31398a047e24ba4a7eb",id:this.containerId,class:`adyen-container ${this.disabled?"disabled":""}`}),this.errorMessage&&i("div",{key:"bb0ca17dfb484a12e10914834e236bc69a5c4b96",class:"error-message",role:"alert"},this.errorMessage))}get el(){return this}static get style(){return o()}},[2,"credit-card-form",{adyenConfig:[16],placeholder:[16],disabled:[4],isReady:[32],isValid:[32],errorMessage:[32]}]);function h(){if(typeof customElements==="undefined"){return}const t=["credit-card-form"];t.forEach((t=>{switch(t){case"credit-card-form":if(!customElements.get(n(t))){customElements.define(n(t),d)}break}}))}h();export{d as CreditCardForm,h as defineCustomElement};